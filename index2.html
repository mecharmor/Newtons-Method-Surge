<!DOCTYPE html>
<html lang="en">
<head>
  <title>Newton's Method</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="js/mathjs.js"></script>
  <!-- MathJax from CDN -->
  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <!-- Algebrite -->
  <script src="js/algebrite.bundle-for-browser.js"></script>
  <!-- JSX Graph -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsxgraph/0.99.5/jsxgraphcore.js"></script>
  <style>
   #functioninput{
     width:80%;
     margin: 0 auto;
   }
   
   #functionoutput{ 
     margin-top: 10px;
     margin-bottom: 10px;
   }
   
   #derivativeoutput{
     margin-bottom: 10px;
   }
   
   #myGraph{
     margin-bottom: 15px;
     visibility: hidden;
   }
   
   #guessInputGroup{
     visibility: hidden;
     margin-top: 10px;
   }
   
   #AnswersDiv{
     margin-top: 25px;
     margin-bottom: 40px;
     visibility: hidden;
   }
   
   .MyBoxLeft{
    text-align:center;
    margin: auto; 
    width: 80%;
   }

   .MyBoxLeft2{
    text-align:center;
    margin: auto; 
    width: 80%;
    visibility: hidden;
   }
   
   .MyBoxBottom{
    text-align:center;
    margin: auto; 
    width: 80%;
   }
   
   #GraphAdjustments{
    position: fixed;
    left: 0;
    visibility: hidden;
    top: 35%;
   }
    
  </style>

</head>
<body>
  
<div class="container">
  <h1 class="text-center">Newton's Method</h1>
  <div class="input-group" id="functioninput">
    <span class="input-group-addon" id="basic-addon1">f(x) = </span>
    <input type="text" class="form-control" id="inputfunction" placeholder="Enter function" aria-describedby="basic-addon1" autofocus>
  </div>
  <div class="MyBoxLeft" style="width:80%; margin: 0 auto;">
    <div id="functionoutput" class="text-center"></div>
    <div id="derivativeoutput" class="text-center"></div>
  </div>

  <div id="GraphAdjustments">
      <!--Graph Adjustments-->
      <div class="btn-group-vertical">
        <button type="button" class="btn btn-default" id="GraphThicker"><span class="glyphicon glyphicon-plus"></span></button>
        <button type="button" class="btn btn-default" id="GraphThinner"><span class="glyphicon glyphicon-minus"></span></button>
        <button type="button" class="btn btn-default" id="GraphColor"><span class="glyphicon glyphicon-tint"></span></button>
        <button type="button" class="btn btn-danger" id="GraphColor"><span class="glyphicon glyphicon-remove"></span></button>
      </div>
  </div>

  <div class="MyBoxLeft2" style="width:80%; margin: 0 auto; height:50vh">
      <!--Graph Div-->
      <div id="myGraph" class="jxgbox center-block" style='width:100%; height:100%; border: 1px solid lightgray; box-shadow: 2px 2px 5px grey;'></div>
  </div>

  <div class="MyBoxLeft" id="guessInputGroup">
  <div class="input-group" style="width:40%; margin: 0 auto;">
    <span class="input-group-addon" id="basic-addon1">User Guess = </span>
    <input type="text" class="form-control" id="userGuess" aria-describedby="basic-addon1"> 
  </div>
  </div>
  <div id="AnswersDiv">
      <div class="MyBoxBottom"><p id="myOutput">Hmmmm.... Javascript didn't output answer</p></div>
  </div>
    
</div>

<script>
  
  var userGuess;
  var Result;
  var counter;
  var answer;
  var delta;
  var Result = ""; //Used to output iterations of x
  var ChangeOfxResult = ""; // used to output results for change of x
  var XiterationsArray = ["Results"]; //storing information into array for resizing with slider
  var ChangeofXArray = ["Change of X"]; //same purpose as the XitterationsArray but for Change of x
  var jsinitialfunction;
  var GraphThickness = 3;
  var ThisStrokeColor = "#0000ff";

  
  $(document).ready(function(){

    //Graph Thicker Button
    $("#GraphThicker").click(function(){
        if (GraphThickness <= 15) { //Set Max Thickness
            GraphThickness +=1 //Changing Graph Thickness
            board.removeObject(DrawingGraph);
            DrawingGraph = board.create('functiongraph',[function(x){ with(Math) return eval(jsinitialfunction);}], {strokeColor:ThisStrokeColor, strokeWidth:GraphThickness}); 
        }
    });
    //Graph Thinner Button
    $("#GraphThinner").click(function(){
        if (GraphThickness >= 2) { //Set Min thickness
            GraphThickness -=1 //Changing Graph Thickness
            board.removeObject(DrawingGraph);
            DrawingGraph = board.create('functiongraph',[function(x){ with(Math) return eval(jsinitialfunction);}], {strokeColor:ThisStrokeColor,strokeWidth:GraphThickness});
        }
    });
     //Graph Color Button
     var ColorSelector = 0;
    $("#GraphColor").click(function(){
        //Colors Array
        var MyArray = ["#00ff00", "#ffff00", "#ff0000","#b300b3","#ff5500","#0000ff"];
        //Reset if 6
        if (ColorSelector == 6){ColorSelector = 0;}
        //Set Color of Array in position
        ThisStrokeColor = MyArray[ColorSelector]
        //Remove
        board.removeObject(DrawingGraph);
        //Add new
        DrawingGraph = board.create('functiongraph',[function(x){ with(Math) return eval(jsinitialfunction);}], {strokeColor:ThisStrokeColor,strokeWidth:GraphThickness});
        //Next Color
        ColorSelector +=1
    });
    
    $("#inputfunction").on("keyup", function(e){
      
      //Graph
         board = JXG.JSXGraph.initBoard('myGraph',
                     {
                         boundingbox:[-7,2,7,-2],
                         axis: { ticks: { drawLabels: true }, firstArrow: true, strokeColor: 'black'}, //if , strokeWidth is added then the axis will change thickness
                         grid: { strokeWidth: 0.75 },//Changes line thickness of grid
                         showCopyright: false,
                         showNavigation: false,
                         keepaspectratio: false, //square graph coming in
                         zoom: {
                            factorX: 1.25,  // horizontal zoom factor (multiplied to JXG.Board#zoomX)
                            factorY: 1.25,  // vertical zoom factor (multiplied to JXG.Board#zoomY)
                            wheel: true,  // allow zooming by mouse wheel
                            needshift: false, // mouse wheel zooming needs pressing of the shift key
                             eps: 0.1        // minimal values of JXG.Board#zoomX and JXG.Board#zoomY
                         },
                         pan: {
                            enabled: true,   // Allow panning
                            needTwoFingers: true, // panningis done with two fingers on touch devices
                            needshift: false, // mouse panning needs pressing of the shift key
                         }
                         
                     });
           
       board.removeObject(myGraph);

       var initialfunction;
      
      $("#derivativeoutput").html("Hit Enter");
     
       initialfunction = $(this).val();
      
      $("#functionoutput").html("`f(x) = " + initialfunction + "`");
      MathJax.Hub.Queue(["Typeset",MathJax.Hub,"functionoutput"]);
      
      if(e.keyCode === 13){

        var derivativefunction = Algebrite.run('d('+ initialfunction +')');
        
        $("#derivativeoutput").html("`f'(x) = " + derivativefunction + "`");
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,"derivativeoutput"]);
        
          // now getting the function and derivative into jsmath
          jsinitialfunction = mathjs(initialfunction, 'x');
          jsderivfunction = mathjs(derivativefunction, 'x');
            
          // fade in graph and next input box           
          $('.MyBoxLeft2').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 500);
          $(".MyBoxLeft2").show(500);
          //+- on left side to adjust graph thickness
          $('#GraphAdjustments').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 500);
          $('#myGraph').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 900);
          $("#myGraph").show(900);
          DrawingGraph = board.create('functiongraph',[function(x){ with(Math) return eval(jsinitialfunction);}], {strokeColor:ThisStrokeColor,strokeWidth:GraphThickness});//strokeWidth is where the graph changes size
          
          $('#guessInputGroup').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 500);
          $("#guessInputGroup").show(1000);

          //Focus on next input box
          $("#userGuess").focus()
          
          $("#userGuess").on("keyup", function(e){
             if(e.keyCode === 13){
              Result = "";
              ChangeOfxResult = "";
              counter = 1;
            
              userGuess = $("#userGuess").val();
              userGuess = parseFloat(userGuess).toFixed(8);
              
              Result += "x0 = " + userGuess + "<br>";
              
              do{  //Applying Newtons Method
                        
                        // Use Math to access trig functions
                        var evalInitialFunction;
                        var evalDerivFunction;
                        with(Math){
                        evalInitialFunction = eval(jsinitialfunction.replace(/x/g, userGuess));
                        evalDerivFunction = eval(jsderivfunction.replace(/x/g, userGuess));
                        }
                        
                        // Here it comes: the big moment                  
                        answer = userGuess - (evalInitialFunction/evalDerivFunction);
                        // Ta-da! There's the line that actually does the formula
                        
                        
                        //Set Delta
                        delta = answer - userGuess;
                              
                        //Set new userGuess
                        userGuess = answer;
                        
                        answer = parseFloat(answer).toFixed(10);
                        Result += "x" + counter + " = " + answer + "<br>";//Writing to MyOutput String
                        XiterationsArray[counter] = answer;//filling array
                
                        
                        ChangeOfxResult += "<span>&#916;</span>x" + counter + "= " + delta + "<br>"; //Writing to ChangeX string
                        ChangeofXArray[counter] = delta;//filling array with each change of x
    
                        counter ++;
                        
                        if (counter > 10000){
    
                            Result = "It looks like this function doesn't converge to a root!"; //+ "<br>" + Result
                            ChangeOfxResult = "";
                            
                            break;
                          
                        }
                        //console.log(Result);
                        if (answer == "NaN" || answer == "Infinity"){

                           Result = "No Root was found";
                           ChangeOfxResult = "";
                           break;

                        }
    
                    }while(delta > 0.001 || delta < -0.001);
                    
                  //Plot Crit
                  answer = parseFloat(answer).toFixed(2);
                  var p = board.create('point', [answer,0], {style:6, name:"(" + answer + ", 0)"}); 
              
                  //Fade in answers
                  $('#AnswersDiv').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 500);
                  $('#myOutput').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 1000);
                  
                  $("#AnswersDiv").show(500);
                  $("#myOutput").show(1000);
                  
                  //Output Answer
                  $('#myOutput').html(Result);
                 
               }
              });

             
          
          
        
      }
      
    });
    
  });
    
  
  
</script>

</body>
</html>